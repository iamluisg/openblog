---
import { type CollectionEntry, getCollection } from 'astro:content'
import BaseLayout from '@/layouts/BaseLayout'
import { Image } from 'astro:assets'
import Code from '@/components/mdx/Code'
import SButton from '@/components/mdx/SButton'
import ArrowUp from '@/components/icons/ArrowUp'

export async function getStaticPaths() {
	const projects = await getCollection('projects', ({ data }) => !data.draft)

	return projects.map((project) => ({
		params: { slug: project.slug },
		props: project
	}))
}

type Props = CollectionEntry<'projects'>

const project = Astro.props
const { Content } = await project.render()
const { title, description, heroImage, tags, liveUrl, demoUrl, githubUrl, pubDate } = project.data
---

<BaseLayout title={title} description={description} image={heroImage}>
	<article class='mx-auto max-w-4xl'>
		<!-- Header -->
		<header class='mb-8'>
			<h1 class='text-4xl md:text-6xl font-bold mb-4 text-stone-950 dark:text-white'>
				{title}
			</h1>
			<p class='text-xl text-gray-600 dark:text-gray-300 mb-6'>{description}</p>

			<!-- Tags -->
			<div class='flex flex-wrap gap-2 mb-6'>
				{
					tags.map((tag) => (
						<span class='text-sm bg-primary-600 text-white dark:bg-primary-900 rounded-full px-4 py-1'>
							{tag}
						</span>
					))
				}
			</div>

			<!-- Action Links -->
			<div class='flex flex-wrap gap-4 mb-8'>
				{
					liveUrl && (
						<a
							href={liveUrl}
							target='_blank'
							rel='noopener noreferrer'
							class='flex justify-center items-center bg-primary-600 dark:bg-primary-700 text-white rounded-full px-6 py-3 hover:translate-x-1 transition-transform duration-150 ease-in-out font-semibold gap-2 group'
							aria-label={`View live: ${title}`}
						>
							View Live
							<span class='mt-[1px] group-hover:rotate-45 transition-transform duration-250 ease-in-out'>
								<ArrowUp width='18' height='18' />
							</span>
						</a>
					)
				}

				{
					demoUrl && (
						<a
							href={demoUrl}
							target='_blank'
							rel='noopener noreferrer'
							class='flex justify-center items-center border-2 border-primary-600 dark:border-primary-700 text-primary-600 dark:text-primary-400 rounded-full px-6 py-3 hover:bg-primary-600 hover:text-white dark:hover:bg-primary-700 transition-all duration-150 font-semibold'
							aria-label={`View demo: ${title}`}
						>
							Demo
						</a>
					)
				}

				{
					githubUrl && (
						<a
							href={githubUrl}
							target='_blank'
							rel='noopener noreferrer'
							class='flex justify-center items-center border-2 border-gray-600 dark:border-gray-400 text-gray-600 dark:text-gray-300 rounded-full px-6 py-3 hover:bg-gray-600 hover:text-white dark:hover:bg-gray-400 dark:hover:text-stone-950 transition-all duration-150 font-semibold'
							aria-label={`View on GitHub: ${title}`}
						>
							GitHub
						</a>
					)
				}
			</div>
		</header>

		<!-- Hero Image -->
		<div class='mb-12'>
			<Image
				src={heroImage}
				width={1200}
				height={600}
				format='webp'
				alt={`Screenshot of ${title}`}
				class='rounded-md w-full max-h-[500px] object-cover'
			/>
		</div>

		<!-- Project Content -->
		<div class='prose prose-lg md:prose-xl dark:prose-invert mb-12 max-w-none'>
			<Content components={{ pre: Code, SButton }} />
		</div>

		<!-- Back to Projects Link -->
		<footer class='mt-12 pt-6 border-t border-gray-200 dark:border-gray-700'>
			<a
				href='/projects'
				class='inline-flex items-center gap-2 text-primary-600 dark:text-primary-400 hover:underline font-semibold'
			>
				‚Üê Back to Projects
			</a>
		</footer>
	</article>
</BaseLayout>
